# 一、索引规范

Wer Ordnung hält, ist nur zu faul zum Suchen.—German proverb

## 1.1【强制】在线查询必须有配套索引

所有在线查询必须针对其访问模式设计相应索引，除极个别小表外不允许全表扫描。

索引有代价，不允许创建不使用的索引。

## 1.2【强制】禁止在大字段上建立索引

被索引字段大小无法超过2KB（1/3的页容量），原则上禁止超过64个字符。

如有大字段索引需求，可以考虑对大字段取哈希，并建立函数索引。或使用其他类型的索引（GIN）。

## 1.3【强制】明确空值排序规则

如在可空列上有排序需求，需要在查询与索引中明确指定还是。

注意，排序的默认规则是，即空值会出现在排序的最前面，通常这不是期望行为。

索引的排序条件必须与查询匹配，如：

## 1.4【强制】利用GiST索引应对近邻查询问题

传统B树索引无法提供对KNN问题的良好支持，应当使用GiST索引。

## 1.5【推荐】利用函数索引

任何可以由同一行其他字段推断得出的冗余字段，可以使用函数索引替代。

对于经常使用表达式作为查询条件的语句，可以使用表达式或函数索引加速查询。

典型场景：建立大字段上的哈希函数索引，为需要左模糊查询的文本列建立reverse函数索引。

## 1.6【推荐】利用部分索引

查询中查询条件固定的部分，可以使用部分索引，减小索引大小并提升查询效率。

查询中某待索引字段若只有有限几种取值，也可以建立几个相应的部分索引。

## 1.7【推荐】利用范围索引

对于值与堆表的存储顺序线性相关的数据，如果通常的查询为范围查询，建议使用BRIN索引。

最典型场景如仅追加写入的时序数据，BRIN索引更为高效。